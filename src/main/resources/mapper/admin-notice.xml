<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.foodreport.domain.admin.notice.model.dao.AdminNoticeMapper">
	
	<!-- 공지사항 insert -->
	<insert id = "saveNotice"
		parameterType="AdminNoticeDTO"
		>
	<selectKey resultType="long" keyProperty="noticeNo" order="BEFORE">
		SELECT SEQ_NOTICE_NO.NEXTVAL FROM DUAL
	</selectKey>
		INSERT 
  		  INTO 
  	   		   FR_NOTICE
  	   		   (
  	   		   NOTICE_NO,
  	   		   NOTICE_TITLE,
  	   		   NOTICE_CONTENT,
  	   		   VIEW_COUNT,
  	   		   STATUS,
  	   		   CREATE_DATE,
  	   		   UPDATE_DATE,
  	   		   DELETE_DATE,
  	   		   MEMBER_NO
  	   		   )
		VALUES 
	   		   (
	   			 #{noticeNo},
	   			 #{noticeTitle},
	   			 #{noticeContent},
	   			 DEFAULT,
	   			 DEFAULT,
	   			 DEFAULT,
	   			 NULL,
	   			 NULL,
	   			 #{refMemberNo}
	   		   )
	</insert>
	
	<!-- 공지사항 이미지 insert -->
	<insert id = "saveImage"
		parameterType="AdminNoticeImage">
		INSERT
		  INTO
		  	   FR_NOTICE_IMAGE
		  	   (
		  	   IMAGE_NO,
		  	   ORIGIN_NAME,
		  	   CHANGE_NAME,
		  	   STATUS,
		  	   CREATE_DATE,
		  	   UPDATE_DATE,
		  	   DELETE_DATE,
		  	   NOTICE_NO
		  	   )
		VALUES 
			   (
			   SEQ_NOTICE_IMAGE_NO.NEXTVAL,
			   #{originName},
			   #{changeName},
			   DEFAULT,
			   DEFAULT,
			   NULL,
			   NULL,
			   #{refNoticeNo}
			   )
	</insert>
	
	<select id="findAllNotice"
		resultMap="AdminNoticeResponse">
		SELECT
			   N.NOTICE_NO noticeNo
			 , N.NOTICE_TITLE noticeTitle
			 , N.NOTICE_CONTENT noticeContent
			 , N.VIEW_COUNT view
			 , N.STATUS status
			 , N.CREATE_DATE createDate
			 , N.UPDATE_DATE updateDate
			 , N.DELETE_DATE deleteDate
			 , N.MEMBER_NO refMemberNo
			 , CHANGE_NAME noticeImageUrl
		  FROM
		  	   FR_NOTICE N
		  LEFT JOIN FR_NOTICE_IMAGE I ON I.NOTICE_NO = N.NOTICE_NO
		  ORDER
		     BY 
		        N.NOTICE_NO DESC
		 OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY;
	</select>
</mapper>